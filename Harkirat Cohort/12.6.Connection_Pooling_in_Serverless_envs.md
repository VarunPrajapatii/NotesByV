Why do you need connection pooling when youre using edge runtime. Why does a simple prisma project not work in serverless backend specifically in cloudflare workers.
## Serverless backend when connecting to backend
Serverless environments have one big problem when dealing with databases. 
- There can be many connections open to the DB since there can be multiple workers open in various regions. And generally the databases have limit to the max number of open connections they can have.
- And Prisma the library has dependencies that the cloudflare runtime doesnâ€™t understand. (see this)[https://www.prisma.io/docs/accelerate] (and this)[https://www.prisma.io/docs/orm/prisma-client/deployment/edge/deploy-to-cloudflare-workers]



So many workers are connected to the connection pools, and that pool is connected to the database.
And prisma have lets say engine folder in the node_modules, they are heavily relied on nodejs and there are other dependencies there that can run with all runtimes.
So if you want to deploy your website over to cloudflare workers, dont include this dependencies and also maintain a connection pool, have a different postgres connection pool url that your workers connecto to and that pool connects to the database.
These are the 2 things prisma expects you to do if youre deploying a Prisma application on cloudflare workers.


Lets revise to initialize a cloudflare project:
- npm create cloudflare@latest
- open in vs code
- you can add hono to it.
- npm install --save-dev prisma
- npx prisma init
- in the schema.prisma, url were putting is neon or aiven. we'll see eventually
- Prisma orm currently doesnot works on cloudflare workers yet. However, you can use prisma orm on cloudflare workers through Prisma Accelerate.
- So go to Prisma connection pool, create a new pool and enable accelerate and give it that connection string youve got from neon or aiven.
- Then enable accelerate, then generate accelerate connection string and copy it.
- This is what you will use on your worker.
- If you see schema.prisma it want the url from env, and when you are using cloudflare workers a way to inject env variable is by using wrangler.toml file(write [vars] before writing the url variable).
- Remember: all the url you will be using in index.ts will be in wrangler file and all the url that you will be using from cli will be in env. You will be needing the direct url if you are directly connecting to the database for migrations.
- You make a new field in schema.prisma called DIRECT_URL which is the aiven or neon url. You get it from env. You have to prepend "postgres://" before the url.
- "npm install @prisma/extension-accelerate"
- then generate "npx prisma generate --no-engine" if you want to use it with the cloudflare workers then you need to generate it with the --no-engine flag. It generates with a less bundle size.
- then you can add the function to add data in the index.js (see the docs for demo code)
- then you deploy that and open the link, you will see the json prints there.

So, you will have a worker running routed to the database through the connection pool.
