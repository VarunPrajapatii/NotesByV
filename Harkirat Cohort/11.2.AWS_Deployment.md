# AWS Deployment

AWS is Amazonâ€™s cloud service.
- Rent servers
- Manage domains
- Upload objects (mp4 files, jpgs, mp3s â€¦)
- Autoscale servers
- Create k8s clusters


Virtual Machines on AWS are called EC2 Servers. EC2 stands for Elastic compute Version 2.
- Elastic - Can increase/decrease the size of the machine
- Compute - It is a machine
*You can spin up a new EC2 instance from the aws dashboard*

### Creating a new EC2 server:
1. Click on Launch a new instance
2. Give a name 
3. Select an OS
4. Select size
5. Create a new Key pair
6. Select Size
7. Allow traffic on http/https


### SSH into the server
1. Give ssh key permissions
"chmod 700 kirat-class.pem"
2. ssh into machine
"ssh -i kirat-class.pem ubuntu@ec2-65-0-180-32.ap-south-1.compute.amazonaws.com"
3. Clone repo
"git clone (link)"
>
If your aws machine shows "Temporary failure in name resolution" you the following error, your aws machine doesnâ€™t have access to the internet
Solution - https://www.tecmint.com/resolve-temporary-failure-in-name-resolution/
>
4. Install Node.jsðŸ’¡
https://www.digitalocean.com/community/tutorials/how-to-install-node-js-on-ubuntu-20-04
5. Install all dependencies
"cd (folder name)"
"npm install"
6. Start backend
"node index.js"


### Try hitting the Server
You have an ip/DNS that you can hit to access your ec2 server.
You will be opening your website hosted like http://your_domain:8080, you have to write :8080 everytime.
If it was on port 80 then you dont have to mention it, you can hit the domain name with http, or if it was on port 443 you didnt need to mention the port, you can directly hit the domain name with https.


### Reverse Proxy
Now lets say you were able to run it on port to 80 some how, now you need not to mention the port number, now lets say you have to deploy another backend here, you cannot have two process on port 80.
On the ip/machine you bought, you want be1.varun.com and be2.varun.com both to run, but you cant run both to port 80. So be1 running on 3000 and be2 running on 3001, so we use reverse proxy here.
We have ec2 machine were running something else on port 80, a reverse proxy, and it takes care that if incoming url is be1 then it send req to 3000, and if incoming url is be2 then it sends the request to 3001.



## nginx
NGINX is open source software for web serving, reverse proxying, cachiing, load balancing, media streaming, and more.It can also function as a proxy server for email and reverse proxy and load balancer for HTTP, TCP and UDP servers.

1. Install nginx
"sudo apt update
sudo apt install nginx"

2. Create reverse proxy
"sudo rm sudo vi /etc/nginx/nginx.conf
sudo vi /etc/nginx/nginx.conf"

```bash
    events {
        # Event directives...
    }

    http {
        server {
        listen 80;
        server_name be1.100xdevs.com;

        location / {
            proxy_pass http://localhost:8080;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection 'upgrade';
            proxy_set_header Host $host;
            proxy_cache_bypass $http_upgrade;
        }
        }
    }
```

3. Start the backend server
"node index.js"

4. Visit the website